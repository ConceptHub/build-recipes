MAJOR_VERSION=2021
MINOR_VERSION=3
PACKAGE_NAME='gromacs-'$MAJOR_VERSION.$MINOR_VERSION
FILE_NAME=$PACKAGE_NAME'.tar.gz'
CMAKE_BUILD_DIR_PREFIX='build'
BUILD_DIR=~/build


# ===

CMAKE_BUILD_DIR=$BUILD_DIR/$PACKAGE_NAME/$CMAKE_BUILD_DIR_PREFIX

cd $BUILD_DIR
rm -fr $PACKAGE_NAME
tar xvf $FILE_NAME
mkdir $CMAKE_BUILD_DIR
cd $CMAKE_BUILD_DIR

module purge
module load intel
module load mkl/latest
module load mpi/latest
module load compiler/latest
module load cmake/latest
module load gcc/11/latest

INSTALL_PREFIX=/opt/software/gromacs/$MAJOR_VERSION/$MAJOR_VERSION.$MINOR_VERSION-intel-mkl-nogpu-intelmpi

cmake .. -DBUILD_SHARED_LIBS=ON -DGMX_MPI=ON -DGMX_OPENMP=ON -DGMX_GPU=OFF -DGMX_HWLOC=OFF -DGMX_OPENMP_MAX_THREADS=256 -DGMX_FFT_LIBRARY=mkl -DGMX_SIMD=AVX2_256 -DCMAKE_C_COMPILER=icc -DCMAKE_C_FLAGS="-mfma" -DCMAKE_CXX_COMPILER=icpc -DCMAKE_CXX_FLAGS="-mfma" -DBUILD_SHARED_LIBS=ON -DGMX_THREAD_MPI=OFF -DGMX_EXTERNAL_BLAS=ON -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX -DGMX_EXTERNAL_BLAS=ON -DGMX_BLAS_USER=/opt/software/intel/oneapi/mkl/latest/lib/intel64/libmkl_rt.so

make -j48 install


cd $BUILD_DIR
rm -fr $PACKAGE_NAME
tar xvf $FILE_NAME
mkdir $CMAKE_BUILD_DIR
cd $CMAKE_BUILD_DIR

module purge
module load intel
module load mkl/latest
module load compiler/latest
module load cmake/latest
module load gcc/11/latest

INSTALL_PREFIX=/opt/software/gromacs/$MAJOR_VERSION/$MAJOR_VERSION.$MINOR_VERSION-intel-mkl-nogpu-threadmpi

cmake .. -DBUILD_SHARED_LIBS=ON -DGMX_MPI=OFF -DGMX_OPENMP=ON -DGMX_GPU=OFF -DGMX_HWLOC=OFF -DGMX_OPENMP_MAX_THREADS=256 -DGMX_FFT_LIBRARY=mkl -DGMX_SIMD=AVX2_256 -DCMAKE_C_COMPILER=icc -DCMAKE_C_FLAGS="-mfma" -DCMAKE_CXX_COMPILER=icpc -DCMAKE_CXX_FLAGS="-mfma" -DBUILD_SHARED_LIBS=ON -DGMX_THREAD_MPI=ON -DGMX_EXTERNAL_BLAS=ON -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX -DGMX_EXTERNAL_BLAS=ON -DGMX_BLAS_USER=/opt/software/intel/oneapi/mkl/latest/lib/intel64/libmkl_rt.so

make -j48 install


cd $BUILD_DIR
rm -fr $PACKAGE_NAME
tar xvf $FILE_NAME
mkdir $CMAKE_BUILD_DIR
cd $CMAKE_BUILD_DIR

module purge
module load intel
module load mkl/latest
module load compiler/latest
module load cmake/latest
module load gcc/11/latest

INSTALL_PREFIX=/opt/software/gromacs/$MAJOR_VERSION/$MAJOR_VERSION.$MINOR_VERSION-intel-mkl-nogpu-nompi

cmake .. -DBUILD_SHARED_LIBS=ON -DGMX_MPI=OFF -DGMX_OPENMP=ON -DGMX_GPU=OFF -DGMX_HWLOC=OFF -DGMX_OPENMP_MAX_THREADS=256 -DGMX_FFT_LIBRARY=mkl -DGMX_SIMD=AVX2_256 -DCMAKE_C_COMPILER=icc -DCMAKE_C_FLAGS="-mfma" -DCMAKE_CXX_COMPILER=icpc -DCMAKE_CXX_FLAGS="-mfma" -DBUILD_SHARED_LIBS=ON -DGMX_THREAD_MPI=OFF -DGMX_EXTERNAL_BLAS=ON -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX -DGMX_EXTERNAL_BLAS=ON -DGMX_BLAS_USER=/opt/software/intel/oneapi/mkl/latest/lib/intel64/libmkl_rt.so

make -j48 install


cd $BUILD_DIR
rm -fr $PACKAGE_NAME


